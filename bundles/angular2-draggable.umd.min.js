!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs/observable/fromEvent")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/observable/fromEvent"],e):e(t["angular2-draggable"]={},t.ng.core,t.Rx.Observable)}(this,function(t,n,i){"use strict";var s=(r.fromEvent=function(t,e){if(void 0===e&&(e=null),this.isMouseEvent(t))return new r(t.clientX,t.clientY);if(null===e||1===t.changedTouches.length)return new r(t.changedTouches[0].clientX,t.changedTouches[0].clientY);for(var n=0;n<t.changedTouches.length;n++)if(t.changedTouches[n].target===e)return new r(t.changedTouches[n].clientX,t.changedTouches[n].clientY)},r.isMouseEvent=function(t){return 8===Object.prototype.toString.apply(t).indexOf("MouseEvent")},r.isIPosition=function(t){return!!t&&"x"in t&&"y"in t},r.getCurrent=function(t){var e=new r(0,0);if(window){var n=window.getComputedStyle(t);if(n){var i=parseInt(n.getPropertyValue("left"),10),s=parseInt(n.getPropertyValue("top"),10);e.x=isNaN(i)?0:i,e.y=isNaN(s)?0:s}return e}return console.error("Not Supported!"),null},r.copy=function(t){return new r(0,0).set(t)},Object.defineProperty(r.prototype,"value",{get:function(){return{x:this.x,y:this.y}},enumerable:!0,configurable:!0}),r.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},r.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},r.prototype.multiply=function(t){this.x*=t,this.y*=t},r.prototype.divide=function(t){this.x/=t,this.y/=t},r.prototype.reset=function(){return this.x=0,this.y=0,this},r.prototype.set=function(t){return this.x=t.x,this.y=t.y,this},r);function r(t,e){this.x=t,this.y=e}var o=(e.prototype.add=function(){this.parent&&!this._added&&(this.parent.appendChild(this._helper),this._added=!0)},e.prototype.remove=function(){this.parent&&this._added&&(this.parent.removeChild(this._helper),this._added=!1)},e.prototype.dispose=function(){this._helper=null,this._added=!1},Object.defineProperty(e.prototype,"el",{get:function(){return this._helper},enumerable:!0,configurable:!0}),e);function e(t,e){this.parent=t,this.renderer=e,this._added=!1;var n=e.createElement("div");e.setStyle(n,"position","absolute"),e.setStyle(n,"width","100%"),e.setStyle(n,"height","100%"),e.setStyle(n,"background-color","transparent"),e.setStyle(n,"top","0"),e.setStyle(n,"left","0"),this._helper=n}var h=(Object.defineProperty(a.prototype,"zIndex",{set:function(t){this.renderer.setStyle(this.el.nativeElement,"z-index",t),this._zIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ngDraggable",{set:function(t){if(t!==undefined&&null!==t&&""!==t){this.allowDrag=!!t;var e=this.getDragEl();this.allowDrag?this.renderer.addClass(e,"ng-draggable"):(this.putBack(),this.renderer.removeClass(e,"ng-draggable"))}},enumerable:!0,configurable:!0}),a.prototype.ngOnInit=function(){if(this.allowDrag){var t=this.getDragEl();this.renderer.addClass(t,"ng-draggable")}this.resetPosition()},a.prototype.ngOnDestroy=function(){this.bounds=null,this.handle=null,this.orignal=null,this.oldTrans=null,this.tempTrans=null,this.currTrans=null,this._helperBlock.dispose(),this._helperBlock=null,this.draggingSub&&this.draggingSub.unsubscribe()},a.prototype.ngOnChanges=function(t){if(t.position&&!t.position.isFirstChange()){var e=t.position.currentValue;this.moving?this.needTransform=!0:(s.isIPosition(e)?this.oldTrans.set(e):this.oldTrans.reset(),this.transform())}},a.prototype.ngAfterViewInit=function(){this.inBounds&&(this.boundsCheck(),this.oldTrans.add(this.tempTrans),this.tempTrans.reset())},a.prototype.getDragEl=function(){return this.handle?this.handle:this.el.nativeElement},a.prototype.resetPosition=function(){s.isIPosition(this.position)?this.oldTrans.set(this.position):this.oldTrans.reset(),this.tempTrans.reset(),this.transform()},a.prototype.moveTo=function(t){this.orignal&&(t.subtract(this.orignal),this.tempTrans.set(t),this.tempTrans.divide(this.scale),this.transform(),this.bounds&&this.edge.emit(this.boundsCheck()),this.movingOffset.emit(this.currTrans.value))},a.prototype.transform=function(){var t=this.tempTrans.x+this.oldTrans.x,e=this.tempTrans.y+this.oldTrans.y;"x"===this.lockAxis?(t=this.oldTrans.x,this.tempTrans.x=0):"y"===this.lockAxis&&(e=this.oldTrans.y,this.tempTrans.y=0),1<this.gridSize&&(t=Math.round(t/this.gridSize)*this.gridSize,e=Math.round(e/this.gridSize)*this.gridSize);var n="translate("+Math.round(t)+"px, "+Math.round(e)+"px)";this.renderer.setStyle(this.el.nativeElement,"transform",n),this.renderer.setStyle(this.el.nativeElement,"-webkit-transform",n),this.renderer.setStyle(this.el.nativeElement,"-ms-transform",n),this.renderer.setStyle(this.el.nativeElement,"-moz-transform",n),this.renderer.setStyle(this.el.nativeElement,"-o-transform",n),this.currTrans.x=t,this.currTrans.y=e},a.prototype.pickUp=function(){if(this.oldZIndex=this.el.nativeElement.style.zIndex?this.el.nativeElement.style.zIndex:"",window&&(this.oldZIndex=window.getComputedStyle(this.el.nativeElement,null).getPropertyValue("z-index")),this.zIndexMoving&&this.renderer.setStyle(this.el.nativeElement,"z-index",this.zIndexMoving),!this.moving){this.started.emit(this.el.nativeElement),this.moving=!0;var t=this.getDragEl();this.renderer.addClass(t,"ng-dragging"),this.subscribeEvents()}},a.prototype.subscribeEvents=function(){var e=this;this.draggingSub=i.fromEvent(document,"mousemove",{passive:!1}).subscribe(function(t){return e.onMouseMove(t)}),this.draggingSub.add(i.fromEvent(document,"touchmove",{passive:!1}).subscribe(function(t){return e.onMouseMove(t)})),this.draggingSub.add(i.fromEvent(document,"mouseup",{passive:!1}).subscribe(function(){return e.putBack()})),/msie\s|trident\//i.test(window.navigator.userAgent)||this.draggingSub.add(i.fromEvent(document,"mouseleave",{passive:!1}).subscribe(function(){return e.putBack()})),this.draggingSub.add(i.fromEvent(document,"touchend",{passive:!1}).subscribe(function(){return e.putBack()})),this.draggingSub.add(i.fromEvent(document,"touchcancel",{passive:!1}).subscribe(function(){return e.putBack()}))},a.prototype.unsubscribeEvents=function(){this.draggingSub.unsubscribe(),this.draggingSub=null},a.prototype.boundsCheck=function(){if(this.bounds){var t=this.bounds.getBoundingClientRect(),e=this.el.nativeElement.getBoundingClientRect(),n={top:!!this.outOfBounds.top||t.top<e.top,right:!!this.outOfBounds.right||t.right>e.right,bottom:!!this.outOfBounds.bottom||t.bottom>e.bottom,left:!!this.outOfBounds.left||t.left<e.left};return this.inBounds&&(n.top||(this.tempTrans.y-=(e.top-t.top)/this.scale),n.bottom||(this.tempTrans.y-=(e.bottom-t.bottom)/this.scale),n.right||(this.tempTrans.x-=(e.right-t.right)/this.scale),n.left||(this.tempTrans.x-=(e.left-t.left)/this.scale),this.transform()),n}},a.prototype.getCurrentOffset=function(){return this.currTrans.value},a.prototype.putBack=function(){if(this._zIndex?this.renderer.setStyle(this.el.nativeElement,"z-index",this._zIndex):this.zIndexMoving&&(this.oldZIndex?this.renderer.setStyle(this.el.nativeElement,"z-index",this.oldZIndex):this.el.nativeElement.style.removeProperty("z-index")),this.moving){this.stopped.emit(this.el.nativeElement),this._helperBlock.remove(),this.needTransform&&(s.isIPosition(this.position)?this.oldTrans.set(this.position):this.oldTrans.reset(),this.transform(),this.needTransform=!1),this.bounds&&this.edge.emit(this.boundsCheck()),this.moving=!1,this.endOffset.emit(this.currTrans.value),this.trackPosition&&this.oldTrans.add(this.tempTrans),this.tempTrans.reset(),this.trackPosition||this.transform();var t=this.getDragEl();this.renderer.removeClass(t,"ng-dragging"),this.unsubscribeEvents()}},a.prototype.checkHandleTarget=function(t,e){if("BUTTON"===e.tagName)return!1;if(e===t)return!0;for(var n in e.children)if(e.children.hasOwnProperty(n)&&this.checkHandleTarget(t,e.children[n]))return!0;return!1},a.prototype.onMouseDown=function(t){if(!(t instanceof MouseEvent&&2===t.button)){var e=t.target||t.srcElement;this.handle!==undefined&&!this.checkHandleTarget(e,this.handle)||!1===this.allowDrag||(this.preventDefaultEvent&&(t.stopPropagation(),t.preventDefault()),this.orignal=s.fromEvent(t,this.getDragEl()),this.pickUp())}},a.prototype.onMouseMove=function(t){this.moving&&this.allowDrag&&(this.preventDefaultEvent&&(t.stopPropagation(),t.preventDefault()),this._helperBlock.add(),this.moveTo(s.fromEvent(t,this.getDragEl())))},a);function a(t,e){this.el=t,this.renderer=e,this.allowDrag=!0,this.moving=!1,this.orignal=null,this.oldTrans=new s(0,0),this.tempTrans=new s(0,0),this.currTrans=new s(0,0),this.oldZIndex="",this._zIndex="",this.needTransform=!1,this.draggingSub=null,this._helperBlock=null,this.started=new n.EventEmitter,this.stopped=new n.EventEmitter,this.edge=new n.EventEmitter,this.outOfBounds={top:!1,right:!1,bottom:!1,left:!1},this.gridSize=1,this.inBounds=!1,this.trackPosition=!0,this.scale=1,this.preventDefaultEvent=!1,this.position={x:0,y:0},this.lockAxis=null,this.movingOffset=new n.EventEmitter,this.endOffset=new n.EventEmitter,this._helperBlock=new o(t.nativeElement,e)}h.decorators=[{type:n.Directive,args:[{selector:"[ngDraggable]",exportAs:"ngDraggable"}]}],h.ctorParameters=function(){return[{type:n.ElementRef},{type:n.Renderer2}]},h.propDecorators={started:[{type:n.Output}],stopped:[{type:n.Output}],edge:[{type:n.Output}],handle:[{type:n.Input}],bounds:[{type:n.Input}],outOfBounds:[{type:n.Input}],gridSize:[{type:n.Input}],zIndexMoving:[{type:n.Input}],zIndex:[{type:n.Input}],inBounds:[{type:n.Input}],trackPosition:[{type:n.Input}],scale:[{type:n.Input}],preventDefaultEvent:[{type:n.Input}],position:[{type:n.Input}],lockAxis:[{type:n.Input}],movingOffset:[{type:n.Output}],endOffset:[{type:n.Output}],ngDraggable:[{type:n.Input}],onMouseDown:[{type:n.HostListener,args:["mousedown",["$event"]]},{type:n.HostListener,args:["touchstart",["$event"]]}]};var u=function l(){};u.decorators=[{type:n.NgModule,args:[{imports:[],declarations:[h],exports:[h]}]}],u.ctorParameters=function(){return[]},t.AngularDraggableModule=u,t.ɵa=h,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=angular2-draggable.umd.min.js.map
